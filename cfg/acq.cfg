// config file for nuphase-acq
// not all options are changeable by restart

// settings related to threshold  / trigger control
// These all can be set without restarting
control:
{
   // scaler goals for each beam, desired rate ( in Hz)
   scaler_goals = {
     0 : 1,
     1 : 1,
     2 : 1,
     3 : 1,
     4 : 1,
     5 : 1,
     6 : 1,
     7 : 1,
     8 : 1,
     9 : 1,
     10 : 1,
     11 : 1,
     12 : 1,
     13 : 1,
     14 : 1 
    };

   //the beams allowed to participate in the trigger
   trigger_mask = 0xe;

   // the channels on the master allowed to participate in the trigger
   channel_mask = 0xf;

   // pid loop proportional term
   k_p = 10;

   // pid loop integral term
   k_i = 10;

   // pid loop differential term
   k_d = 0;

   //monitoring interval, for PID loop (in seconds)
   monitor_interval = 1;

   // software trigger interval (in seconds)
   sw_trigger_interval = 1;

   //enable the phased trigger readout
   enable_phased_trigger = 1;

   //delay for phased trigger to start
   secs_before_phased_trigger = 20;

   //weight of fast scaler in pid loop
   fast_scaler_weight = 0.7;

   //weight of slow scaler in pid loop
   slow_scaler_weight = 0.3;

  //number of fast scalers to average
  n_fast_scaler_avg = 20;

  //File to persist the status info (primarily for saving thresholds between restarts)
  status_save_file = "/data/last.st.bin"

  // load thresholds from status file on start.
  load_thresholds_from_status_file=1

};

// settings related to the acquisition
// Not all of these can be set without restarting
device: 
{
  //spi devices, master first, requires restart to change
  spi_devices = ("/dev/spidev2.0", "/dev/spidev1.0"); 

  // circular buffer capacity. In-memory storage in between acquisition and writing. Requires restart.
  buffer_capacity = 100;

  //the length of a waveform, in samples. 
  waveform_length = 384;

  //the pretrigger window length, in hardware units
  pretrigger = 4;

  //calpulser state, 0 (off) , 2 (baseline)  or 3 (calpulser)
  calpulser_state = 0;

  // Whether or not to enable the external triggers
  enable_trigout = 1;

  //spi clock speed, MHz
  spi_clock = 20;

  // True to apply attenuations 
  apply_attenuations = 1;

  // attenuation, per channel, if applied. 
  attenuation = ( {0:9,1:3,2:11,3:8,4:7,5:19,6:11,7:3},{0:23,1:10,2:27,3:27,4:0,5:0,6:0,7:0} );

  //which channels to digitize
  channel_read_mask = (0xf, 0x7); 

  //command used to run the alignment program.
  alignment_command="/usr/bin/env python /home/nuphase/nuphase-python/align_adcs.py",

};

//settings related to output
output: 
{
  // Run file, used to persist run number
  run_file = "/data/runfile";

  // output directory, data will go here
  output_directory = "/data/" ;

  //print to screen interval (0 to disable)
  print_interval = 5;

  // run length, in seconds
  run_length = 7200; 

  //events per output file
  events_per_file = 1000;

  //statuses per output file
  status_per_file = 200;

};

